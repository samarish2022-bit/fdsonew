# Анализ медленной загрузки контента в мобильной версии

## Основные причины

### 1. **Ожидание всех данных перед отрисовкой (водопад)**
- В `site-data.js` контент выводится только после **Promise.all([loadNewsFromFile(), loadCompetitionsFromFile(), loadDocumentsFromFile(), loadPhotosFromFile()])** — то есть после завершения **всех четырёх** запросов.
- На мобильном интернете один из запросов (или несколько) может идти дольше; пользователь ждёт самого медленного, при этом экран уже может показывать «Пока нет новостей» и т.п.
- **Решение:** рендерить каждый блок по мере прихода своих данных: как только загрузились новости — показать новости, как только соревнования — соревнования и т.д. (прогрессивная загрузка).

### 2. **Блокирующие скрипты в конце страницы**
- Подключаются по порядку: Bootstrap → GSAP → ScrollTrigger → Lucide → site-data.js → main.js. Каждый скрипт загружается и выполняется последовательно; до конца не отработают — контент не инициализируется.
- На мобильном устройстве задержка на каждый запрос к CDN (cdn.jsdelivr.net) и парсинг/выполнение тяжёлых библиотек (GSAP, ScrollTrigger, Lucide) увеличивают время до появления контента.
- **Решение:** для некритичных скриптов (GSAP, ScrollTrigger, Lucide) использовать `defer` или подключать их после первого отображения контента; оставить критичные (Bootstrap, site-data) для быстрой отрисовки.

### 3. **Четыре независимых запроса к API/файлам**
- Одновременно идут запросы к `/api/news`, `/api/competitions`, `/api/documents`, `/api/photos` (или к статическим JSON). На 3G/4G каждый запрос даёт задержку; если один «висит», обновление интерфейса откладывается из‑за Promise.all.
- **Решение:** прогрессивный рендер (п.1) уменьшает ощущение медленной загрузки; при необходимости можно объединить часть данных в один endpoint (например, «начальная лента»).

### 4. **Cache-buster при каждой загрузке**
- Для новостей, соревнований и документов используется `?t=Date.now()` при запросе к API/файлам, из‑за чего ответы не кэшируются браузером. Каждый заход на главную снова тянет все JSON.
- На мобильном это увеличивает трафик и время до появления контента.
- **Решение:** убрать `?t=` для запросов к API (сервер уже отдаёт Cache-Control) или использовать короткий max-age и не сбрасывать кэш при каждом открытии.

### 5. **Тяжёлая анимация и иконки**
- GSAP + ScrollTrigger создают анимации при скролле; Lucide подменяет разметку иконок на SVG. На слабых мобильных процессорах это добавляет время выполнения JS и отрисовки.
- **Решение:** отложенная инициализация анимаций (после первого рендера) или отключение/упрощение анимаций на мобильных (media query или проверка ширины).

### 6. **Размер и порядок загрузки ресурсов**
- Bootstrap CSS и основной style.css блокируют первый отрисовку; hero-изображение и картинки в секциях грузятся параллельно с данными. На медленной сети большие CSS/JS и много картинок увеличивают время до «контент виден».
- **Решение:** уже сделанные оптимизации (кэш картинок, превью, WebP для hero) помогают; дополнительно можно отложить невидимые ниже первого экрана изображения (lazy) и не блокировать первый кадр лишним JS.

---

## Что сделано в коде

- **Прогрессивная загрузка:** новости, соревнования, документы и фото рендерятся по отдельности сразу после загрузки своего источника. Больше не ждём завершения всех четырёх запросов — контент появляется по мере готовности.
- При необходимости можно добавить: `defer` для GSAP/ScrollTrigger/Lucide, снятие cache-buster для API и отложенный запуск анимаций на мобильных.
